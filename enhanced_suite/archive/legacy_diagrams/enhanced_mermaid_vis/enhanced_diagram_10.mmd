%%{
  init: {
    'theme': 'default',
    'themeVariables': {
      'primaryColor': '#ff6b6b',
      'primaryTextColor': '#2c3e50',
      'primaryBorderColor': '#3498db',
      'lineColor': '#34495e',
      'secondaryColor': '#f8f9fa',
      'tertiaryColor': '#e9ecef',
      'clusterBkg': '#ffffff',
      'clusterBorder': '#dee2e6',
      'fontSize': '18px',
      'fontFamily': 'Arial, sans-serif'
    }
  }
}%%

graph LR
    subgraph "Adaptive Weight Calculation"
        A[NLL Loss<br/>L_nll] --> B[Gradients<br/>grad_L_nll]
        C[Generator Loss<br/>L_g] --> D[Gradients<br/>grad_L_g]
        
        B --> E[Gradient Norm<br/>norm of grad_L_nll]
        D --> F[Gradient Norm<br/>norm of grad_L_g]
        
        E --> G[Weight Ratio<br/>w = weight ratio calculation]
        F --> G
        
        G --> H[Clamp Range<br/>w in range 0 to 10000]
        H --> I[Final Weight<br/>w_final = w * disc_weight]
    end
    
    style A fill:#fff3e0,stroke:#e65100,stroke-width:2px,font-weight:bold
    style C fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-weight:bold
    style I fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,font-weight:bold