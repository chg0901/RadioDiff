%%{
  init: {
    'theme': 'default',
    'themeVariables': {
      'primaryColor': '#ff6b6b',
      'primaryTextColor': '#2c3e50',
      'primaryBorderColor': '#3498db',
      'lineColor': '#34495e',
      'secondaryColor': '#f8f9fa',
      'tertiaryColor': '#e9ecef',
      'clusterBkg': '#ffffff',
      'clusterBorder': '#dee2e6',
      'fontSize': '16px',
      'fontFamily': 'Arial, sans-serif'
    }
  }
}%%

graph TB
    subgraph "Phase 2: VAE-GAN Training (Steps 50,001+)"
        A[NLL Loss<br/>L_nll] --> E[Total Loss]
        B[KL Loss<br/>w_kl × L_kl] --> E
        C[Adaptive Weight<br/>d_weight] --> D[Adversarial Component]
        F[Generator Loss<br/>L_g] --> D
        D --> E
        
        E --> G[L_total = L_nll + w_kl×L_kl + d_weight×disc_factor×L_g]
        
        H[disc_factor] --> I[Adopt Weight<br/>disc_factor = 1.0]
        J[global_step >= 50001] --> I
    end
    
    style A fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px,font-weight:bold
    style B fill:#fff3e0,stroke:#e65100,stroke-width:3px,font-weight:bold
    style C fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,font-weight:bold
    style F fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,font-weight:bold
    style G fill:#ffecb3,stroke:#ff8f00,stroke-width:3px,font-weight:bold